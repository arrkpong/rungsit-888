{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>Bills</title>
{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/index/styles.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* Apply Kanit font to the entire page */
    body {
        font-family: 'Kanit', sans-serif;
    }

    .filter-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
    }

    .search {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 20px auto;
        text-align: left;
    }

    .filter-section .search input {
        margin-right: 10px;
        padding: 5px;
    }

    .filter-section .search button {
        padding: 5px 15px;
    }

    .filter-section .filter-buttons {
        display: flex;
        gap: 10px;
    }

    .filter-buttons button {
        padding: 5px 10px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th,
    td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
    }

    th {
        background-color: #f4f4f4;
    }

    .text-green {
        color: green;
    }

    .text-red {
        color: red;
    }

    .flag {
        width: 30px;
        height: 20px;
    }

    .note {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .note-button {
        border: none;
        background-color: transparent;
        color: red;
        cursor: pointer;
    }

    .filter-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
    }

    .filter-section .search {
        display: flex;
        align-items: center;
    }

    .filter-section .search input {
        margin-right: 10px;
        padding: 5px;
    }

    .filter-section .search button {
        padding: 5px 15px;
    }

    .filter-section .filter-buttons {
        display: flex;
        gap: 10px;
    }

    .filter-buttons button {
        padding: 5px 10px;
    }

    .bill-header {
        font-size: 30px;
        font-weight: bold;
    }

    .search {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        font-weight: bold;
    }

    .date-group {
        margin-bottom: 10px;
    }

    .date-group label {
        display: inline-block;
        width: 100px;
    }

    .date-group input {
        padding: 5px;
        font-size: 14px;
    }

    label {
        margin-bottom: 5px;
    }

    .search-button {
    padding: 7px 16px;
    font-size: 14px;
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 27px; /* Adjust to fine-tune alignment if necessary */
    border-radius: 5px;
    }
    .button-group {
        display: flex;
        gap: 2px;
        margin-bottom: 10px;
    }
    .button-group button {
        padding: 4px 10px;
        background-color: #007bff;
        color: white;
        border: 1px solid #ccc;
        cursor: pointer;
        border-radius: 5px;
        font-size: 10px;
    }
    .button-orangegroup {
        display: flex;
        gap: 2px;
        margin-bottom: 10px;
    }
    .button-orangegroup button {
    padding: 4px 10px;
    background-color: rgba(247, 103, 7, 1); /* Corrected RGBA value */
    color: white;
    cursor: pointer;
    border-radius: 5px;
    font-size: 10px;
    }
    .date-info {
        margin-top: 15px;
        font-size: 14px;
        color: #666;
    }

    button {
        padding: 5px 10px;
        font-size: 16px;
        cursor: pointer;
    }

    .search-container {
        max-width: 600px;
        margin-left: 0;
        font-family: 'Kanit', sans-serif;
    }

    .date-picker-section {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }

    .date-picker {
        display: flex;
        flex-direction: column;
    }

    .date-picker input {
        padding: 5px 10px;
        font-size: 14px;
        width: 170px;
    }

    .quick-buttons {
        display: flex;
        gap: 2px;
        margin-bottom: 10px;
    }

    .quick-buttons button {
        padding: 4px 10px;
        background-color: #007bff;
        color: white;
        border: 1px solid #ccc;
        cursor: pointer;
        border-radius: 5px;
        font-size: 10px;
    }

    .info-text {
        font-size: 12px;
        margin-top: 10px;
    }

    .info-text span {
        color: #007bff;
        font-weight: bold;
    }
    .action-button {
        background-color: #ffa500; /* Orange color */
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        margin-left: 5px;
    }
    .search-notes input {
        padding: 10px;
        font-size: 12px;
        border-radius: 5px;
        border: 1px solid #ccc;
        flex-grow: 1;
    }

    .note-button {
        background-color: transparent;
        border: none;
        color: red;
        cursor: pointer;
    }
    tfoot {
    background-color: #f4f4f4;
    font-weight: bold;
    }

    tfoot td {
        padding: 10px;
        border: 1px solid #ddd;
    }

    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .pagination button {
        padding: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        margin: 0 5px;
        border-radius: 5px;
    }

    .pagination span {
        padding: 10px;
        font-size: 16px;
    }

</style>
{% endblock %}

{% block content %}
<div class="search-container">
    <h2>ข้อมูลบิล</h2>
    <div class="date-picker-section">
        <div class="date-picker">
            <label for="from-date">ตั้งแต่วันที่</label>
            <input type="date" id="from-date" name="from-date">
        </div>
        <div class="date-picker">
            <label for="to-date">ถึงวันที่</label>
            <input type="date" id="to-date" name="to-date">
        </div>
        <button class="search-button">ค้นหา</button>
    </div>
    <div class="quick-buttons">
        <button id="today-btn">วันนี้</button>
        <button id="yesterday-btn">เมื่อวาน</button>
        <button id="this-week-btn">สัปดาห์นี้</button>
        <button id="last-week-btn">สัปดาห์ที่แล้ว</button>
        <button id="this-month-btn">เดือนนี้</button>
        <button id="last-month-btn">เดือนที่แล้ว</button>
    </div>
    <div class="info-text">
        ข้อมูลตั้งแต่วันที่ <span id="display-start-date">26 กันยายน 2024</span> ถึง <span id="display-end-date">26 กันยายน 2024</span>
    </div>

    <!-- Add the orange button section here -->
    <div class="button-orangegroup" style="display: flex; justify-content: flex-end; margin-left: 700px; width: 100%; height: 20;">
        <button class="action-button">ทั้งหมด</button>
        <button class="action-button">บิลได้</button>
        <button class="action-button">บิลเสีย</button>
        <button class="action-button">รอผล</button>
        <button class="action-button">บิลยกเลิก</button>
    </div>    

    <!-- Add a search bar to search notes -->
    <div class="search-notes" style="display: flex; flex-direction: column; align-items: flex-start; margin-top: 2px; margin-left: 1096px; width: 100%;">
        <label for="search-note" style="margin-bottom: 1px;">ค้นหา</label>
        <input type="text" id="search-note"style="padding: 6px; font-size: 15px; width: 200px; margin-bottom: 10px;">
    </div>   
</div>

<table id="bill-table">
    <thead>
        <tr>
            <th>#</th>
            <th>สินค้า</th>
            <th>ประจำวัน</th>
            <th>เวลา</th>
            <th>สถานะ</th>
            <th>ยอดรวม</th>
            <th>ถูก</th>
            <th>คงเหลือ</th>
            <th>note</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <!-- Sample data rows -->
        <tr>
            <td>#6707c2e77057e2993b569e0</td>
            <td>ดาวน์โหลด VIP</td>
            <td>06 ตุลาคม 2024</td>
            <td>2024-10-07 00:03:35</td>
            <td><span class="text-blue">รอผล</span></td>
            <td><span class="text-green">-1,065</span></td>
            <td>0</td>
            <td><span class="text-red">-1,065</span></td>
            <td>ณรงค์ พันล่า 3 ตัวไม่รับ</td>
            <td><button class="note-button">ลบ</button></td>
        </tr>
        <tr>
            <td>#6707c2e77057e2993b569e0</td>
            <td>ดาวน์โหลด VIP</td>
            <td>06 ตุลาคม 2024</td>
            <td>2024-10-07 00:03:35</td>
            <td><span class="text-blue">รอผล</span></td>
            <td><span class="text-green">-1,065</span></td>
            <td>0</td>
            <td><span class="text-red">-65</span></td>
            <td>ณรงค์ พันล่า 3 ตัวไม่รับ</td>
            <td><button class="note-button">ลบ</button></td>
        </tr>
        <!-- Add more rows as needed -->
    </tbody>
    <tfoot>
        <tr>
            <td style="font-weight: bold;">รวม</td>
            <td id="total-items"></td>
            <td colspan="3"></td>
            <td id="total-amount"></td>
            <td></td>
            <td id="total-remaining"></td>
            <td colspan="2"></td>
        </tr>
    </tfoot>
</table>

<!-- Pagination Buttons -->
<div class="pagination">
    <button onclick="previousPage()">&#60;</button>
    <span id="page-number">1</span>
    <button onclick="nextPage()">&#62;</button>
</div>

<script>
    function updateDateInfo() {
        const startDate = document.getElementById('from-date').value;
        const endDate = document.getElementById('to-date').value;

        document.getElementById('display-start-date').textContent = new Date(startDate).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('display-end-date').textContent = new Date(endDate).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];

        document.getElementById('from-date').value = todayString;
        document.getElementById('to-date').value = todayString;
        updateDateInfo();
    });

    // Event listeners for the quick-buttons
    document.getElementById('today-btn').addEventListener('click', function() {
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];
        document.getElementById('from-date').value = todayString;
        document.getElementById('to-date').value = todayString;
        updateDateInfo();
    });

    document.getElementById('yesterday-btn').addEventListener('click', function() {
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);
        const yesterdayString = yesterday.toISOString().split('T')[0];
        document.getElementById('from-date').value = yesterdayString;
        document.getElementById('to-date').value = yesterdayString;
        updateDateInfo();
    });

    document.getElementById('this-week-btn').addEventListener('click', function() {
        const today = new Date();
        const firstDayOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 1)); // Monday
        const todayString = new Date().toISOString().split('T')[0];
        document.getElementById('from-date').value = firstDayOfWeek.toISOString().split('T')[0];
        document.getElementById('to-date').value = todayString;
        updateDateInfo();
    });

    document.getElementById('last-week-btn').addEventListener('click', function() {
        const today = new Date();
        const lastWeekEnd = new Date(today.setDate(today.getDate() - today.getDay()));
        const lastWeekStart = new Date(today.setDate(lastWeekEnd.getDate() - 6));
        document.getElementById('from-date').value = lastWeekStart.toISOString().split('T')[0];
        document.getElementById('to-date').value = lastWeekEnd.toISOString().split('T')[0];
        updateDateInfo();
    });

    document.getElementById('this-month-btn').addEventListener('click', function() {
        const today = new Date();
        const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
        const todayString = today.toISOString().split('T')[0];
        document.getElementById('from-date').value = firstDayOfMonth.toISOString().split('T')[0];
        document.getElementById('to-date').value = todayString;
        updateDateInfo();
    });

    document.getElementById('last-month-btn').addEventListener('click', function() {
        const today = new Date();
        const firstDayLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
        const lastDayLastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
        document.getElementById('from-date').value = firstDayLastMonth.toISOString().split('T')[0];
        document.getElementById('to-date').value = lastDayLastMonth.toISOString().split('T')[0];
        updateDateInfo();
    });

    // Search functionality
    document.getElementById('search-note').addEventListener('input', function() {
        const searchValue = this.value.toLowerCase();
        const rows = document.querySelectorAll('#bill-table tbody tr');

        rows.forEach(row => {
            const noteText = row.querySelector('td:nth-child(9)').textContent.toLowerCase();
            if (noteText.includes(searchValue)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
    let currentPage = 1;
    const rowsPerPage = 10;  // Adjust based on how many rows you want per page

    function previousPage() {
        if (currentPage > 1) {
            currentPage--;
            updateTable();
        }
    }

    function nextPage() {
        currentPage++;
        updateTable();
    }

    function updateTable() {
        const table = document.getElementById('bill-table').getElementsByTagName('tbody')[0];
        const rows = table.getElementsByTagName('tr');
        const totalRows = rows.length;
        
        // Calculate the range of rows to display
        const startRow = (currentPage - 1) * rowsPerPage;
        const endRow = Math.min(startRow + rowsPerPage, totalRows);

        // Hide all rows
        for (let i = 0; i < totalRows; i++) {
            rows[i].style.display = 'none';
        }

        // Show the appropriate rows
        for (let i = startRow; i < endRow; i++) {
            rows[i].style.display = '';
        }

        // Update page number display
        document.getElementById('page-number').textContent = currentPage;
    }

    // Initialize the table with the first page
    document.addEventListener('DOMContentLoaded', function () {
        updateTable();
    });
    function updateFooter() {
        const rows = document.querySelectorAll('#bill-table tbody tr');
        const totalItems = rows.length;
        
        let totalAmount = 0;
        let totalRemaining = 0;
        
        rows.forEach(row => {
            // Summing the 'ยอดรวม' column
            const amountText = row.querySelector('td:nth-child(6)').textContent;
            const amount = parseFloat(amountText.replace(/,/g, '')); // remove commas and convert to number
            totalAmount += amount;
            
            // Summing the absolute values of 'คงเหลือ' column
            const remainingText = row.querySelector('td:nth-child(8)').textContent;
            const remaining = Math.abs(parseFloat(remainingText.replace(/,/g, '')));
            totalRemaining += remaining;
        });
        
        // Update footer with total items, total amount, and total remaining
        document.getElementById('total-items').textContent = `${totalItems} รายการ`;
        document.getElementById('total-amount').textContent = totalAmount.toLocaleString(); // formatted with commas
        document.getElementById('total-remaining').textContent = totalRemaining.toLocaleString(); // formatted with commas
    }

    // Run the updateFooter function when the page loads
    document.addEventListener('DOMContentLoaded', updateFooter);

</script>
{% endblock %}